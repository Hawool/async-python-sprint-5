# Проектное задание пятого спринта

Спроектировать и разработать файловое хранилище, которое позволяет хранить различные типы файлов - документы, фотографии, другие данные.


#### Тестовый запуск:
- `git clone https://github.com/Hawool/async-python-sprint-5.git`
- `cd async-python-sprint-4`
- `docker network create file_storage_network`
- `docker build -f dockerization/Dockerfile . -t file_storage`
- `docker-compose -f dockerization/docker-compose.yaml up -d`

#### Тесты:
- `python -m venv venv`
- `source venv/bin/activate`
- запуск БД на 5555 порту для тестов `docker run   --rm     --name postgres-fastapi   -p 5555:5432   -e POSTGRES_USER=postgres   -e POSTGRES_PASSWORD=postgres   -e POSTGRES_DB=collection   -d postgres:14.5`
- `pytest`

## Описание задания

Реализован **http-сервис**, который обрабатывает поступающие запросы. Сервер стартует по адресу `http://127.0.0.1:9000`.

<details>
<summary> Список необходимых эндпойнтов </summary>

1. Статус активности связанных сервисов

```
GET /ping/all
```
Получить информацию о времени доступа ко всем связанным сервисам, например, к БД, в данном случае к бд.

**Response**
```json
{
    "db": 1.27
}
```

2. Регистрация пользователя.

```
POST /auth/register
```
Регистрация нового пользователя. Запрос принимает на вход логин и пароль для создания новой учетной записи.


3. Авторизация пользователя.

```
POST /auth/jwt/login
```
Запрос принимает на вход логин и пароль учетной записи и возвращает авторизационный токен. Далее все запросы проверяют наличие токена в заголовках - `Authorization: Bearer <token>`


4. Информация о загруженных файлах

```
GET /file/list
```
Вернуть информацию о ранее загруженных файлах. Доступно только авторизованному пользователю.

**Response**
```json
{
    "files": [
          {
            "id": "a19ad56c-d8c6-4376-b9bb-ea82f7f5a853",
            "name": "notes.txt",
            "created_ad": "2020-09-11T17:22:05Z",
            "path": "/homework/test-fodler/notes.txt",
          },
          {
            "id": "113c7ab9-2300-41c7-9519-91ecbc527de1",
            "name": "tree-picture.png",
            "created_ad": "2019-06-19T13:05:21Z",
            "path": "/homework/work-folder/environment/tree-picture.png",
          }
    ]
}
```


5. Загрузить файл в хранилище

```
POST /file
```
Метод загрузки файла в хранилище. Доступно только авторизованному пользователю.
Для загрузки заполняется полный путь до файла, в который будет загружен/переписан загружаемый файл. Если нужные директории не существуют, то они будут созданы автоматически.
Так же, есть возможность указать путь до директории. В этом случае имя создаваемого файла будет создано в соответствии с текущим передаваемым именем файла.

**Request parameters**
```json
{
    "name": "tree-picture.png",
    "file": "/homework/work-folder/environment/tree-picture.png",
}
```
**Response**
```json
{
    "id": "a19ad56c-d8c6-4376-b9bb-ea82f7f5a853",
    "name": "notes.txt",
    "created_ad": "2020-09-11T17:22:05Z",
    "path": "/homework/test-fodler/notes.txt",
}
```


6. Скачать загруженный файл

```
GET /file/download
```
Скачивание ранее загруженного файла. Доступно только авторизованному пользователю.

**Path parameters**
```
/?path=<path-to-file>||<file-meta-id>
```
Возможность скачивания есть как по переданному пути до файла, так и по идентификатору.


</details>


## Дополнительные требования (отметьте выбранные пункты):

- [X] (2 балла) Добавление информация об использовании пользователем дискового пространства.

<details>
<summary> Описание изменений </summary>

```
GET /file/usage_memory
```
Вернуть информацию о статусе использования дискового пространства и ранее загруженных файлах. Доступно только авторизованному пользователю.

**Response**
```json
{
    "files": 1024
}
```
</details>

## Требования к решению

1. В качестве СУБД используйте PostgreSQL не ниже 10 версии.
2. Опишите [docker-compose](docker-compose.yml) для разработки и локального тестирования сервисов.
3. Используйте концепции ООП.
4. Предусмотрите обработку исключительных ситуаций.
5. Приведите стиль кода в соответствие pep8, flake8, mypy.
6. Логируйте результаты действий.
7. Покройте написанный код тестами.


## Рекомендации к решению

1. За основу можно взять реализацию проекта 4 спринта.
2. Разрешено использовать готовые библиотеки и пакеты, например, для авторизации. Для поиска можно использовать [сервис openbase](https://openbase.com/categories/python), [PyPi](https://pypi.org/) или на [GitHub](https://github.com/search?).
3. Используйте **in-memory-db** для кэширования данных.
4. Для скачивания файлов можно использовать возможности сервера отдачи статики, для хранения - облачное объектное хранилище (s3).
